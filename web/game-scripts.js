var Player=pc.createScript("player");Player.attributes.add("skin",{type:"number",default:1}),Player.attributes.add("speed",{type:"number",default:2}),Player.attributes.add("rightWall",{type:"number",default:2.2}),Player.attributes.add("leftWall",{type:"number",default:-2.2}),Player.attributes.add("topWall",{type:"number",default:1.39}),Player.attributes.add("bottomWall",{type:"number",default:-.75}),Player.attributes.add("isGround",{type:"boolean",default:!1}),Player.attributes.add("isJump",{type:"boolean",default:!1}),Player.prototype.initialize=function(){this.coords=new pc.Vec3,this.camera=this.app.root.findByName("Camera").camera},Player.prototype.update=function(t){this.move(t),this.checkjumpGround(t),this.checkBound(t)},Player.prototype.move=function(t){var e=this.app.keyboard.isPressed(pc.KEY_LEFT),i=this.app.keyboard.isPressed(pc.KEY_RIGHT),s=this.app.keyboard.isPressed(pc.KEY_UP),a=this.app.keyboard.isPressed(pc.KEY_DOWN);e&&this.entity.translate(-this.speed*t,0,0),i&&this.entity.translate(this.speed*t,0,0),s&&this.isGround&&(this.isJump=!0,this.isGround=!1),a&&this.entity.translate(0,-this.speed*t,0)},Player.prototype.checkjumpGround=function(t){let e=this.entity.getPosition();this.isJump&&(this.entity.translate(0,this.speed*t*(this.bottomWall-e.y+2.2),0),e.y>0&&(this.isJump=!1)),this.isGround||this.isJump||(this.entity.translate(0,-this.speed*t,0),e.y<this.bottomWall+.01&&(this.entity.setPosition(e.x,e.y-this.topWall+2.2,e.z),this.isGround=!0,this.entity.setPosition(e.x,this.bottomWall,e.z)))},Player.prototype.checkBound=function(t){let e=this.entity.getPosition();e.x<this.leftWall&&this.entity.setPosition(this.leftWall+.001,e.y,e.z),e.x>this.rightWall&&this.entity.setPosition(this.rightWall-.001,e.y,e.z),e.y>this.topWall&&this.entity.setPosition(e.x,this.topWall-.001,e.z),e.y<this.bottomWall&&this.entity.setPosition(e.x,this.bottomWall,e.z)};var Network=pc.createScript("network");Network.attributes.add("skin",{type:"number",default:1}),Network.attributes.add("player",{type:"entity"}),Network.attributes.add("emoji",{type:"entity"}),Network.attributes.add("other",{type:"entity"}),Network.attributes.add("name",{type:"string",default:"noName"}),Network.attributes.add("prePos",{type:"vec3"}),Network.id=null,Network.socket=null,Network.name=null;class Character{constructor(e,t,i,s,r){this.id=e,this.name=t,this.x=i,this.y=s,this.z=0,this.entity=r,this.skin=1}}Network.prototype.initialize=function(){const e=new URLSearchParams(window.location.search);e.has("name")&&(this.name=e.get("name")),this.player.children[0].children[0].element.text=this.name,console.log(this.player.children[0].children[0].element.text),e.has("skin")&&(this.skin=parseInt(e.get("skin"),10)),console.log(this.skin),this.player.sprite.play("Clip "+(this.skin%12+1));const t=new WebSocket("wss://pixel-art-gan-2-d4tkwrdpmq-uc.a.run.app/");Network.socket=t,this.players=new Map,this.prePos=this.player.getPosition(),this.emojiEnable=()=>{this.emoji.enabled=!0},this.emojiDisable=()=>{setTimeout((()=>{this.emoji.enabled=!1}),1e3)};var i=this;let s={type:"initialize",name:this.name,skin:this.skin};t.addEventListener("open",(function(){t.send(JSON.stringify(s))})),t.addEventListener("message",(({data:e})=>{const t=JSON.parse(e);switch(t.type){case"playerMoved":i.movePlayer(t);break;case"playerJoined":console.log(`${t.player.name} is online!`),i.addPlayer(t);break;case"playerData":i.initializePlayers(t);break;case"killPlayer":i.removePlayer(t);break;case"emoji":i.emojiPlayer(t);break;default:throw new Error(`Unsupported event type: ${t.type}.`)}}))},Network.prototype.update=function(e){this.app.keyboard.wasPressed(pc.KEY_Z)&&this.showEmoji("sleep"),this.app.keyboard.wasPressed(pc.KEY_X)&&this.showEmoji("suprise"),this.app.keyboard.wasPressed(pc.KEY_C)&&this.showEmoji("heart"),this.app.keyboard.wasPressed(pc.KEY_V)&&this.showEmoji("facepalm"),this.app.keyboard.wasPressed(pc.KEY_A)&&this.showEmoji("angry"),this.app.keyboard.wasPressed(pc.KEY_S)&&this.showEmoji("777"),this.prePos.x===this.player.getPosition().x&&this.prePos.y===this.player.getPosition().y||(this.prePos=this.player.getPosition(),this.updatePosition())},Network.prototype.showEmoji=function(e){let t={type:"emoji",emoji:e};Network.socket.send(JSON.stringify(t)),this.emojiEnable(),this.emoji.sprite.play(e),this.emojiDisable()},Network.prototype.updatePosition=function(){if(Network.socket.readyState==WebSocket.OPEN){let e=this.player.getPosition(),t={type:"playerMoved",name:this.name,x:e.x,y:e.y};Network.socket.send(JSON.stringify(t))}},Network.prototype.initializePlayers=function(e){Network.id=e.id;for(let t in e.players)p=new Character(e.players[t].id,e.players[t].name,e.players[t].x,e.players[t].y,this.createPlayerEntity(e.players[t])),this.players.set(e.players[t].id,p)},Network.prototype.addPlayer=function(e){p=new Character(e.player.id,e.player.name,e.player.x,e.player.y,this.createPlayerEntity(e.player)),this.players.set(e.player.id,p)},Network.prototype.createPlayerEntity=function(e){if(e.id!=Network.id){this.other.children[0].children[0].element.text=e.name;let t=this.other.clone();return this.app.root.addChild(t),t.enabled=!0,t.setPosition(e.x,e.y,0),t.sprite.play("Clip "+(e.skin%12+1)),t}},Network.prototype.movePlayer=function(e){e.id!=Network.id&&Network.socket.readyState==WebSocket.OPEN&&this.players.get(e.id).entity.setPosition(e.x,e.y,0)},Network.prototype.emojiPlayer=function(e){if(e.id!=Network.id&&Network.socket.readyState==WebSocket.OPEN){let t=this.players.get(e.id).entity.findByName("emoji");t.enabled=!0,t.sprite.play(e.emoji),setTimeout((()=>{t.enabled=!1}),1e3)}},Network.prototype.removePlayer=function(e){this.players.get(e.id).entity&&(this.players.get(e.id).entity.destroy(),this.players.delete(e.id))};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://res.cloudinary.com/startup-grind/image/upload/dpr_2.0,fl_sanitize/v1/gcs/platform-data-dsc/contentbuilder/logo_dark_horizontal_097s7oa.svg",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));